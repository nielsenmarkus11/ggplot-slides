---
title: "ggplot2"
author: "https://mnielsen.shinyapps.io/ggplot"
runtime: shiny
output: 
  ioslides_presentation:
    widescreen: true
    smaller: true
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## CMS Public Data
The data used in these slides is public data located on the CMS page [here](https://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Chronic-Conditions/index.html).  I've arranged the data into a more usable format for this presentation which can be downloaded by clicking the button below.
```{r, echo=FALSE}
ccdat <- read.csv("chronic-conditions.csv")
  
  output$table <- renderTable({
    head(ccdat)
  })

output$downloadData <- downloadHandler(
  filename = 'chronic-conditions.csv',
  content = function(file) {
    write.csv(ccdat, file)}
    )
      
fluidRow(tableOutput('table'),
  downloadButton('downloadData', 'Download')
  )
```


## ggplot2 Basics

    # If you haven't already install the package and load the library.
    install.packages("ggplot2"); library(ggplot2)
    
### ggplot()
    
    # Add layers to ggplot() with '+'
    ggplot([insert data here], aes(x=[x-var], y=[y-var], color=[color-var], [...])) + geom_[graph type]
Layers can include combinations of "geoms", "stats", "scales", "faceting", "themes", etc.

### qplot()

    # Build a plot using the qplot() function
    qplot(x=[x-var], y=[y-var], color=[color-var], [...], data=[insert data here], geom = "[graph type]")
"Some introductions to ggplot2 make use of a function called qplot(), which is intended as a convenient interface for making graphs. It does require a little less typing than using ggplot() plus a geom, but I've found it a bit confusing to use because it has a slightly different way of specifying certain graphing parameters. I think it's simpler and easier to just use ggplot()." -Winston Chang (R Graphics Cookbook, 2012)

## Geoms (One Variable)
alldat <- ccdat[ccdat\$age=="All" & ccdat\$state=="National",]
```{r, echo=FALSE}
library(ggplot2)

new.theme <- theme_update(axis.text = element_text(size=14),axis.title=element_text(size=18))
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
ccdat$state <- trim(ccdat$state)
ccdat$year <- as.numeric(ccdat$year)
alldat <- ccdat[ccdat$age=="All" & ccdat$state=="National",]

fluidRow(
  column(12,
         selectInput("mycode0",label=NULL,
                   choices=c("ggplot(alldat,aes(x=prevalence)) + geom_histogram()",
                            "ggplot(alldat,aes(x=prevalence)) + geom_histogram(binwidth=5)",
                            "ggplot(alldat,aes(x=prevalence)) + geom_density()",
                            "ggplot(alldat,aes(x=prevalence,color=gender)) + geom_density()",
                            "ggplot(alldat,aes(x=prevalence,color=gender,fill=gender)) + geom_density(alpha=0.35)"),
                   selected = "ggplot(alldat,aes(x=prevalence)) + geom_histogram()",width="100%"),
         tags$style(type="text/css", ".selectize-dropdown { width: 100%; font-size: 18px; line-height: 18px;} .selectize-input { width: 100%; font-size: 20px; line-height: 20px;}")
  )
)
renderPlot({
  eval(parse(text=input$mycode0))
},height=450)
```

## Geoms (Two Variables)
alldat <- ccdat[ccdat\$age=="All" & ccdat\$state=="National",]
```{r, echo=FALSE}
library(ggplot2)

new.theme <- theme_update(axis.text = element_text(size=14),axis.title=element_text(size=18))

ccdat <- read.csv("chronic-conditions.csv")
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
ccdat$state <- trim(ccdat$state)
ccdat$year <- as.numeric(ccdat$year)
alldat <- ccdat[ccdat$age=="All" & ccdat$state=="National",]

fluidRow(
  column(10,
         textInput("mycode",label=NULL,
                   value="ggplot(alldat,aes(x=year,y=prevalence)) + geom_point()",width="100%"),
         tags$style(type="text/css", "#mycode { height: 36px; width: 100%; font-size: 18px; display: block;}")
  ),
  column(2,
         actionButton("submit","Submit"),
         tags$style(type="text/css", "#submit { height: 36px; width: 100%; font-size: 18px; display: block;}")
  )
)
renderPlot({
  input$submit
  eval(parse(text=isolate(input$mycode)))
},height=450)
```

## Geoms (Two Variables) cont.
ut.all <- ccdat[ccdat\$state=="Utah" & ccdat\$age=="All" & ccdat\$chronicCondition=="Diabetes",]
```{r, echo=FALSE}
ut.all <- ccdat[ccdat$state=="Utah" & ccdat$age=="All" & ccdat$chronicCondition=="Diabetes",]

fluidRow(
  column(10,
         textInput("mycode3",label=NULL,
                   value="ggplot(ut.all,aes(x=year,y=prevalence,fill=gender)) + geom_bar(stat=\"identity\",position=\"dodge\")",width="100%"),
         tags$style(type="text/css", "#mycode3 { height: 36px; width: 100%; font-size: 16px; display: block;}")
  ),
  column(2,
         actionButton("submit3","Submit"),
         tags$style(type="text/css", "#submit3 { height: 36px; width: 100%; font-size: 16px; display: block;}")
  )
)
renderPlot({
  input$submit3
  eval(parse(text=isolate(input$mycode3)))
},height=450)
```


## Faceting
alldat <- ccdat[ccdat\$age=="All" & ccdat\$state=="National",]
```{r, echo=FALSE}
library(ggplot2)

new.theme <- theme_update(axis.text = element_text(size=14),axis.title=element_text(size=18))

ccdat <- read.csv("chronic-conditions.csv")
trim <- function (x) gsub("^\\s+|\\s+$", "", x)
ccdat$state <- trim(ccdat$state)
ccdat$year <- as.numeric(ccdat$year)
alldat <- ccdat[ccdat$age=="All" & ccdat$state=="National",]

fluidRow(
  column(10,
         textInput("mycode4",label=NULL,
                   value="ggplot(alldat,aes(x=year,y=prevalence,color=chronicCondition)) + geom_point() + geom_line()",width="100%"),
         tags$style(type="text/css", "#mycode4 { height: 36px; width: 100%; font-size: 14px; display: block;}")
  ),
  column(2,
         actionButton("submit4","Submit"),
         tags$style(type="text/css", "#submit4 { height: 36px; width: 100%; font-size: 14px; display: block;}")
  )
)
renderPlot({
  input$submit4
  eval(parse(text=isolate(input$mycode4)))
},height=450)
```

## Citation

- [ggplot2 Cheat Sheet](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)
- CMS Medicare Chronic Conditions data from [cms.gov](https://www.cms.gov/Research-Statistics-Data-and-Systems/Statistics-Trends-and-Reports/Chronic-Conditions/index.html)
- [R Graphics Cookbook](http://www.cookbook-r.com/Graphs/) by Winston Chang


# Questions?